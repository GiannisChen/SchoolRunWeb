<!--<meta http-equiv="X-UA-Compatible" content="ie=edge">-->
<!DOCTYPE html>
<!-- saved from url=(0052)http://getbootstrap.com/docs/4.0/examples/dashboard/ -->
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta name="description" content="">
    <meta name="author" content="">

    <title>Dashboard Template for Bootstrap</title>
    <!-- Bootstrap core CSS -->
    <link href="asserts/css/bootstrap.min.css" th:href="@{/webjars/bootstrap/4.5.2/css/bootstrap.css}" rel="stylesheet">

    <!-- Custom styles for this template -->
    <link href="asserts/css/dashboard.css" th:href="@{/asserts/css/dashboard.css}" rel="stylesheet">
    <script charset="utf-8" th:src="@{https://map.qq.com/api/gljs?v=1.exp&key={key}(key=#{tencent.key})}"></script>
    <style type="text/css">
        /* Chart.js */

        @-webkit-keyframes chartjs-render-animation {
            from {
                opacity: 0.99
            }
            to {
                opacity: 1
            }
        }

        @keyframes chartjs-render-animation {
            from {
                opacity: 0.99
            }
            to {
                opacity: 1
            }
        }

        .chartjs-render-monitor {
            -webkit-animation: chartjs-render-animation 0.001s;
            animation: chartjs-render-animation 0.001s;
        }
    </style>
    <style type="text/css">
        html,
        body {
            height: 100%;
            margin: 0px;
            padding: 0px;
        }

        #container {
            width: 100%;
            height: 80%;
        }

        #toolControl {
            position: absolute;
            top: 10px;
            left: 0px;
            right: 0px;
            margin: auto;
            width: 168px;
            z-index: 1001;
        }
        .toolItem {
            width: 30px;
            height: 30px;
            float: left;
            margin: 1px;
            padding: 4px;
            border-radius: 3px;
            background-size: 30px 30px;
            background-position: 4px 4px;
            background-repeat: no-repeat;
            box-shadow: 0 1px 2px 0 #E4E7EF;
            background-color: #ffffff;
            border: 1px solid #ffffff;
        }
        .toolItem:hover {
            border-color: #789CFF;
        }
        .active {
            border-color: #D5DFF2;
            background-color: #D5DFF2;
        }

        #marker {
            background-image: url('https://mapapi.qq.com/web/lbs/javascriptGL/demo/img/marker_editor.png');
        }
        #polyline {
            background-image: url('https://mapapi.qq.com/web/lbs/javascriptGL/demo/img/polyline.png');
        }
        #polygon {
            background-image: url('https://mapapi.qq.com/web/lbs/javascriptGL/demo/img/polygon.png');
        }
        #circle {
            background-image: url('https://mapapi.qq.com/web/lbs/javascriptGL/demo/img/circle.png');
        }
    </style>
</head>

<body  onload="initMap()">
<!--引入topbar-->
<div th:replace="commons/bar::topbar"></div>
<div class="container-fluid">
    <div class="row">
        <!--引入sidebar-->
        <div th:replace="commons/bar::#sidebar(activeUri='draw_trace.html')"></div>
        <main role="main" class="col-md-9 ml-sm-auto col-lg-10 pt-3 px-4">
            <div id="container"></div>
            <div id="toolControl">
                <div class="toolItem active" id="marker" title="点标记"></div>
                <div class="toolItem" id="polyline" title="折线"></div>
                <div class="toolItem" id="polygon" title="多边形"></div>
                <div class="toolItem" id="circle" title="圆形"></div>
            </div>
<!--            <div>-->
<!--                绘制：鼠标左键点击及移动即可绘制图形<br/>-->
<!--                结束绘制：鼠标左键双击即可结束绘制折线、多边形、多边形会自动闭合；圆形单击即可结束<br/>-->
<!--                中断：绘制过程中按下esc键可中断该过程-->
<!--            </div>-->
        </main>
    </div>
</div>

<!-- Bootstrap core JavaScript
================================================== -->
<!-- Placed at the end of the document so the pages load faster -->
<script type="text/javascript" src="asserts/js/jquery-3.2.1.slim.min.js" th:src="@{/webjars/jquery/3.5.1/jquery.js}"></script>
<script type="text/javascript" src="asserts/js/popper.min.js" th:src="@{/webjars/popper.js/1.11.1/dist/popper.js}"></script>
<script type="text/javascript" src="asserts/js/bootstrap.min.js" th:src="@{/webjars/bootstrap/4.5.2/js/bootstrap.js}"></script>

<!-- Icons -->
<script type="text/javascript" src="asserts/js/feather.min.js" th:src="@{/asserts/js/feather.min.js}"></script>
<script>
    feather.replace()
</script>
<script type="text/javascript">
    var map, editor, activeType = 'marker';

    // 切换激活图层
    document.getElementById('toolControl').addEventListener('click', (e) => {
        let id = e.target.id;
        if (id !== 'toolControl') {
            document.getElementById(activeType).className = "toolItem";
            document.getElementById(id).className = "toolItem active";
            activeType = id;

            editor.setActiveOverlay(id);
        }
    });

    function initMap() {
        // 初始化地图
        map = new TMap.Map("container", {
            zoom: 12, // 设置地图缩放级别
            center: new TMap.LatLng(39.984104, 116.307503) // 设置地图中心点坐标
        });

        // 初始化几何图形及编辑器
        editor = new TMap.tools.GeometryEditor({
            map, // 编辑器绑定的地图对象
            overlayList: [ // 可编辑图层
                {
                    overlay: new TMap.MultiMarker({
                        map
                    }),
                    id: 'marker'
                },
                {
                    overlay: new TMap.MultiPolyline({
                        map
                    }),
                    id: 'polyline'
                },
                {
                    overlay: new TMap.MultiPolygon({
                        map
                    }),
                    id: 'polygon'
                },
                {
                    overlay: new TMap.MultiCircle({
                        map
                    }),
                    id: 'circle'
                }
            ],
            actionMode: TMap.tools.constants.EDITOR_ACTION.DRAW, // 编辑器的工作模式
            activeOverlayId: 'marker', // 激活图层
            snappable: true // 开启吸附
        });

        // 监听绘制结束事件，获取绘制几何图形
        editor.on('draw_complete', (geometry) => {
            console.log(geometry);
        });
    }
</script>

</body>

</html>